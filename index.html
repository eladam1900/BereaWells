<html>
<head>
<meta charset=utf-8 />
<title>Berea Wells</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/1.0.1/simple_statistics.js"></script>
    
<style>
    body 
    { margin:0; 
      padding:0; 
    }
    #map 
    { position:absolute; 
      top:100px; 
      bottom:5px; 
      left:5px; 
      width:60%; 
      border: solid 1px black; 
    }
    h1{
        font-family: sans-serif;
        position: absolute;
        left:12px;
        font-size: 48px;
        color: mediumaquamarine;
        font-style: oblique;
    }
    #sidepanel{
        position: absolute;
        font-family: sans-serif;
        overflow-y: auto;
        right: 30px;
        top:100px;
        width:35%;
        height: 85%;
    }
    #sidepanel p{
        padding-right: 5px;
        margin-top: -2px;
    }
    #legend{
        position: absolute;
        border: solid 1px black;
        background-color: beige;
        padding: 7px;
        left: 15px;
        bottom: 15px;
        font-family: sans-serif;
    }
    #legnd label,
    #legend span {
      display:block;
      float:left;
      height:15px;
      width:20%;
      text-align:center;
      font-size:9px;
      color:#808080;
      }
    #link{
       color:cadetblue;
        font-weight: bold;
        font-style: italic;
        text-decoration: none;
    }
    #content{
        color:darkblue;
        font-size: 12px;
        line-height: 16px;

    }
    #content b{
        font-size:12px;
    }
</style>
</head>
<body>
<h1>Berea Wells and Surrounding Analized Water Wells</h1>
<div id='map'></div>
<div id="sidepanel">
<p>Over the past several years there has been a drilling boom in Northeastern Kentucky. Most of these wells have been drilled into the Berea Sandstone which produces oil and gas. Nationally there has also been a rise in concerns over the drilling practice known as fracking, and it's effect on the environment. More specifically the public has been concerned about induced seismicity (earthquakes caused by human events) and groundwater contamination.<br><br>
The Kentucky Geological Survey is currently in various stages of research studying the Berea at direct and indirect levels. These studies are being performed by staff in the Energy and Minerals Section and the Water Section, but their findings will take up to a year or more to be published. In the meantime here is a map designed to give users access to the various well documents and analysis reports available for both the water and the oil and gas wells.<br><br>
<b>A few facts:</b><br><br>    
1. Over 300 wells have been completed in the Berea in Greenup (~39 oil wells), Lawrence (~110 oil wells, ~85 gas wells, ~10 oil and gas wells), and Johnson (~10 oil wells, ~35 gas wells) Counties.<br><br>
2. The oil wells accounted for about 58% of oil production in Kentucky in 2015. Per well production ranges from 100s to 1,000s barrels per month.<br><br>
3. Measured vertical depths range from about 1,000 to 2,000 ft.<br><br>
4. The wells are fracked over multiple stages using 1,000s of barrels of fluid (1 barrel = 42 gallons) and 100,000s lbs. of sand. Note that the volumes of fluids and sand used in the Berea completions is less than in other unconventional plays, such as the Marcellus, Barnett, or Bakken.<br><br>
5. The current Berea Groundwater project is using a 1,000 meter criteria for it's testing. <a id='link' href='KWRRI_2016_Berea_Rogersville_Baseline.pdf' target=_blank>A review of the project</a> <br><br>
6. Kentucky passed new oil and gas well regulations in 2015 that, among many other things, require operators to test water quality of fresh groundwater wells within 1,000 ft of a high-volume hydraulic fracturing well. <a id='link' href='http://www.kyrc.org/webnewspro/142446477333045.shtml' target="_blank">Summary of Kentucky House Bill 386</a><br><br>
7. The data set used here had the following criteria:<br>
        <ul>
            <li>A complete location</li>
            <li>A total depth</li>
            <li>Well must be active</li>
            <li>Water wells must have an analysis report available</li>
        </ul>
    This is not the same criteria required by the previously mentioned research projects and did alter the overall number of wells displayed.
 </p></div>
    
<div id="legend">
    <strong>Water Well Depth</strong>
    <div class='legend clearfix'>
        <span style='background:#7fcdbb;'></span>
        <span style='background:#41b6c4;'></span>
        <span style='background:#1d91c0;'></span>
        <span style='background:#225ea8;'></span>
        <span style='background:#0c2c84;'></span>
        <label>0 - 500</label>
        <label>-1000</label>
        <label>-1500</label>
        <label>-2000</label>
        <label>-2500+</label>
    </div>
    <hr>
    <strong>Oil and Gas Well Depth</strong>    
    <div class='legend clearfix' >
        <span style='background:#9e9ac8;'></span>
        <span style='background:#807dba;'></span>
        <span style='background:#6a51a3;'></span>
        <span style='background:#54278f;'></span>
        <span style='background:#3f007d;'></span>
        <label>0 - 500</label>
        <label>-1000</label>
        <label>-1500</label>
        <label>-2000</label>
        <label>-2500+</label>    
    </div> 
</div>    
<script>

L.mapbox.accessToken = 'pk.eyJ1IjoiZWxhZGFtMTkwMCIsImEiOiJjaW50MXFnZG4xMWZjdWttM2Nucmduc3E3In0.2v3TohBE2ysztKSUSjhHpg';

var map = L.mapbox.map('map', 'mapbox.outdoors',{
                   center:[38.2, -83.2],
                   zoom: 9,
                   minZoom: 9,
                   maxZoom: 17
            });
    
var ww, og; // globals for layers
    
    
omnivore.topojson('ky-counties-topo.json')
    .on('ready', function(countyborders){
        omnivore.csv('BereaWells_John_Green_Law_Cleaned.csv')
            .on('ready', function(ogWells){
                omnivore.csv('WaterWells_latlong.csv') 
                    .on('ready', function(waterWells) {
                        drawMap(ogWells.target.toGeoJSON(), waterWells.target.toGeoJSON(), countyborders.target.toGeoJSON()) 

                    })

                    .on('error', function(waterWells){
                        console.log(waterWells.error[0].message);
                    })
        }
            )
            .on('error', function(ogWells){
                console.log(ogWells.error[0].message);
            });
});
       
function drawMap(ogWells, waterWells, countyBorders) {
    
    L.geoJson(countyBorders, {
        fillOpacity: 0,
        color: '#ada8a2',
        weight: 3,
        stroke: 1,
        clickable: false
    }).addTo(map);
    
    
    var ogBreaks = getBreaks(ogWells);
    var wwBreaks = getBreaks(waterWells);
    
  ww  = L.geoJson(waterWells, {
       
    pointToLayer: function(feature, layer){
            return L.circleMarker(layer, {
                color: 'white',  
                fillColor: waterMarker(feature.properties.total_depth, wwBreaks),
                stroke: 0.5,
                opacity: 1,
                fillOpacity: 1,
                radius: 5
            });
        }, // end pointToLayer
        
    onEachFeature: function(feature, layer){
        
        var content  = "<p id='content'><b>"+"AKGWA Number: "+"</b>"+feature.properties.AKGWA_NUMBER+"<br>"+"<b>"+"County: "+"</b>"+feature.properties.County+"<br>"+"<b>"+"Primary Use: "+"</b>"+feature.properties.Primary_Use+"<br>"+"<b>"+"Construction Date: "+"</b>"+feature.properties.Construction_Date+"<br>"+"<b>"+"Elevation: "+"</b>"+feature.properties.Surface_Elevation+ "<br>"+"<b>"+"Total Depth: "+"</b>"+feature.properties.total_depth+"<br></p>"  
        
        content += "<div><a href='http://kgs.uky.edu/kgsweb/DataSearching/Water/wellinfo.asp?id="+feature.properties.AKGWA_NUMBER+"' target='_blank'><u id='link'>Well Documents</u></a></div>"
        
   layer.on('click', function(e){
            
    var popup = new L.popup({ offset: new L.Point(0,-10), closeButton: true, autoPan: true })
      .setContent(content)
      .setLatLng(e.latlng)
      .openOn(map);
  });
        
    }
}).addTo(map);    
    
  og = L.geoJson(ogWells, {
      
    pointToLayer: function(feature, layer){
        return L.circleMarker(layer,{
            color: '#e1dede', 
            fillColor: ogMarker(feature.properties.total_depth, ogBreaks),
            stroke: 0.5,
            opacity: 1,
            fillOpacity: 1,
            radius: 5
        });    
        
    },
    onEachFeature: function(feature, layer){
        
        var content  = "<p id='content'><b>"+"Record Number: "+"</b>"+feature.properties.record_number+"<br>"+"<b>"+"Permit Number: "+"</b>"+feature.properties.justified_permit+"<br>"+"<b>"+"County: "+"</b>"+feature.properties.county_name+"<br>"+"<b>"+"Elevation: "+"</b>"+feature.properties.well_elevation+ "<br>"+"<b>"+"Total Depth: "+"</b>"+feature.properties.total_depth+"<br>"+"<b>"+"Completion Date: "+"</b>"+feature.properties.date_completed+"<br>"+"<b>"+"Well Type: "+"</b>"+feature.properties.original_result+"<br>"+"<b>"+"Deepest Producing Formation: "+"</b>"+feature.properties.deepest_pay+"<br></p>"       
        
        content += "<div><a href='http://kgs.uky.edu/kgsweb/datasearching/oilgas/ogresults.asp?recno="+feature.properties.record_number+"&areatype=recno' target='_blank'><u id='link'>Well Documents</u></a></div>"
        
        layer.on('click', function(e){    
            var popup = new L.popup({ offset: new L.Point(0,-10), closeButton: true, autoPan: false })
                  .setContent(content)
                  .setLatLng(e.latlng)
                  .openOn(map);
            
            var info = L.control();

            info.onAdd = function (map) {
        this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
    this.update();
    return this._div;
};
              });
    } 
     
  }).addTo(map);
    
    
  radiusCircle(); 

}    // end drawMap()
    
function getBreaks(wellData) {

     var values=[];
    wellData.features.forEach(function(feature) {
        var value = Number(feature.properties.total_depth);
        values.push(value);
    })
    var clusters = ss.ckmeans(values, 5);
        
    var breaks = clusters.map(function(cluster){
        return [cluster[0],cluster.pop()];
    });
    
    return breaks;
     
}
    
function ogMarker(d, breaks){
    
    
    if(d <= breaks[0][1]){
        return '#9e9ac8'
    }else if (d <= breaks [1][1]){
        return '#807dba'
    }else if (d <= breaks [2][1]){
        return '#6a51a3'
    }else if (d <= breaks[3][1]){
        return '#54278f'
    }else if (d <= breaks[4][1]){
        return '#3f007d'
    }
        
}

function waterMarker(d, breaks){

    
    if(d <= breaks[0][1]){
        return '#7fcdbb'
    }else if (d <= breaks [1][1]){
        return '#41b6c4'
    }else if (d <= breaks [2][1]){
        return '#1d91c0'
    }else if (d <= breaks[3][1]){
        return '#225ea8'
    }else if (d <= breaks[4][1]){
        return '#0c2c84'
    }
        
}       
    

    
function radiusCircle (){
    //create set radius around a well on click
    map.on('click', function(e){
       console.log(e)
       og.eachLayer(function(layer) {
           
        var ogDistance = e.latlng.distanceTo(layer.getLatLng())/1000;
            
            if (ogDistance > 1) {
                    layer.setStyle({
                        stroke: false,
                        fill:false
                    });
            } else{
                layer.setStyle({
                    stroke: true,
                    fill: true 
                });
            }
        
        });
        
        ww.eachLayer(function(layer){
            
        var wwDistance = e.latlng.distanceTo(layer.getLatLng())/1000;
            
            if (wwDistance > 1) {
                    layer.setStyle({
                        stroke: false,
                        fill:false
                    });
            } else{
                layer.setStyle({
                    stroke: true,
                    fill: true 
                });
            }
        });    
    });
}    
</script>

</body>
</html>

