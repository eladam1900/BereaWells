<html>
<head>
<meta charset=utf-8 />
<title>Berea Wells</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/1.0.1/simple_statistics.js"></script>
    
<style>
    body 
    { margin:0; 
      padding:0; 
    }
    #map 
    { position:absolute; 
      top:100px; 
      bottom:5px; 
      left:5px; 
      width:70%; 
      border: solid 1px black; 
    }
    h1{
        font-family: sans-serif;
        position: absolute;
        left:12px;
        font-size: 48px;
        color: mediumaquamarine;
        font-style: oblique;
    }
    #sidepanel{
        position: absolute;
        right: 5px;
        top:100px;
        width:29%;
        height: 50%;
    }
    #sidepanel p{
        font-family: sans-serif;
        padding: 5px;
        position: absolute;
        left: 2px;
        right: 15px;
        text-indent: 40px;
    }
    #legend{
        position: absolute;
        border: solid 1px black;
        padding: 7px;
        right: 90px;
        bottom: 25px;
        font-family: sans-serif;
    }
    #legnd label,
    #legend span {
      display:block;
      float:left;
      height:15px;
      width:20%;
      text-align:center;
      font-size:9px;
      color:#808080;
      }
    .popup{
      color:'black';
      font-family: sans-serif;
      font-size:12px;
      line-height:18px;
        text-transform: lowercase;
    }
    .popup b{
        font-size: 14px;
    }
</style>
</head>
<body>
<h1>Berea Wells and Surrounding Analized Water Wells</h1>
<div class='popup' id='map'></div>
    <div id="sidepanel">
        <p>Over the past several years there has been a drilling boom in Northeastern Kentucky. Most of these wells have been drilled into the Berea Sandstone which produces oil and gas. Nationally there has also been a rise in concerns over the drilling practice known as fracking, and it's effects on the environment. More specifically the public has been concerned with induced seismicity (earthquakes caused by human events) and groundwater contamination.<br><br>This map is designed to give users access to the various well documents and analysis reports for both the water and the oil and gas wells.</p></div>
<div id="legend">
    <strong>Water Well Depth</strong>
    <div class='legend clearfix'>
        <span style='background:#7fcdbb;'></span>
        <span style='background:#41b6c4;'></span>
        <span style='background:#1d91c0;'></span>
        <span style='background:#225ea8;'></span>
        <span style='background:#0c2c84;'></span>
        <label>0 - 500</label>
        <label>-1000</label>
        <label>-1500</label>
        <label>-2000</label>
        <label>-2500+</label>
    </div>
    <hr>
    <strong>Oil and Gas Well Depth</strong>    
    <div class='legend clearfix' >
        <span style='background:#9e9ac8;'></span>
        <span style='background:#807dba;'></span>
        <span style='background:#6a51a3;'></span>
        <span style='background:#54278f;'></span>
        <span style='background:#3f007d;'></span>
        <label>0 - 500</label>
        <label>-1000</label>
        <label>-1500</label>
        <label>-2000</label>
        <label>-2500+</label>    
    </div> 
    
<script>

L.mapbox.accessToken = 'pk.eyJ1IjoiZWxhZGFtMTkwMCIsImEiOiJjaW50MXFnZG4xMWZjdWttM2Nucmduc3E3In0.2v3TohBE2ysztKSUSjhHpg';

var map = L.mapbox.map('map', 'mapbox.outdoors',{
                   center:[38.2, -83.2],
                   zoom: 9,
                   minZoom: 9,
                   maxZoom: 17
            });
    
var ww, og; // globals for layers
    
var customLayer = L.geoJson(null, {
    fillOpacity: 0,
    color: '#ada8a2',
    weight: 3,
    stroke: 1
});
    
var counties = omnivore.topojson('ky-counties-topo.json', null, customLayer).addTo(map);
    
omnivore.csv('BereaWells_John_Green_Law_Cleaned.csv')
    .on('ready', function(ogWells){
        omnivore.csv('WaterWells_latlong.csv') 
            .on('ready', function(waterWells) {
                drawMap(ogWells.target.toGeoJSON(), waterWells.target.toGeoJSON()) 
                
            })

            .on('error', function(waterWells){
                console.log(waterWells.error[0].message);
            })
}
    )
    .on('error', function(ogWells){
        console.log(ogWells.error[0].message);
    });
    
function drawMap(ogWells, waterWells) {
    
    var ogBreaks = getBreaks(ogWells);
    var wwBreaks = getBreaks(waterWells);
    
  ww  = L.geoJson(waterWells, {
       
    pointToLayer: function(feature, layer){
            return L.circleMarker(layer, {
                color: '#d3d3d3',  
                fillColor: waterMarker(feature.properties.total_depth, wwBreaks),
                stroke: 0.5,
                opacity: 1,
                fillOpacity: 1,
                radius: 4
            });
        }, // end pointToLayer
        
    onEachFeature: function(feature, layer){
        
        var content  = "<b>"+"AKGWA Number: "+"</b>"+feature.properties.AKGWA_NUMBER+"<br>"+"<b>"+"County: "+"</b>"+feature.properties.County+"<br>"+"<b>"+"Primary Use: "+"</b>"+feature.properties.Primary_Use+"<br>"+"<b>"+"Construction Date: "+"</b>"+feature.properties.Construction_Date+"<br>"+"<b>"+"Elevation: "+"</b>"+feature.properties.Surface_Elevation+ "<br>"+"<b>"+"Total Depth: "+"</b>"+feature.properties.total_depth+"<br>"  
        
        content += "<div><a href='http://kgs.uky.edu/kgsweb/DataSearching/Water/wellinfo.asp?id="+feature.properties.AKGWA_NUMBER+"' target='_blank'><u>Well Documents</u></a></div></div>"
        
        layer.on('mouseover mousemove', function(e){
    var popup = new L.popup({ offset: new L.Point(0,-10), closeButton: true, autoPan: false })
      .setContent(content)
      .setLatLng(e.latlng)
      .openOn(map);
  });
  layer.on('mouseout', function(e){ map.closePopup() });
        
    }
}).addTo(map);    
    
  og = L.geoJson(ogWells, {
      
    pointToLayer: function(feature, layer){
        return L.circleMarker(layer,{
            color: '#d3d3d3', 
            fillColor: ogMarker(feature.properties.total_depth, ogBreaks),
            stroke: 0.5,
            opacity: 1,
            fillOpacity: 1,
            radius: 4
        });    
        
    },
    onEachFeature: function(feature, layer){
        
        var content  = "<b>"+"Record Number: "+"</b>"+feature.properties.record_number+"<br>"+"<b>"+"Permit Number: "+"</b>"+feature.properties.justified_permit+"<br>"+"<b>"+"County: "+"</b>"+feature.properties.county_name+"<br>"+"<b>"+"Elevation: "+"</b>"+feature.properties.well_elevation+ "<br>"+"<b>"+"Total Depth: "+"</b>"+feature.properties.total_depth+"<br>"+"<b>"+"Completion Date: "+"</b>"+feature.properties.date_completed+"<br>"+"<b>"+"Well Type: "+"</b>"+feature.properties.original_result+"<br>"+"<b>"+"Deepest Producing Formation: "+"</b>"+feature.properties.deepest_pay+"<br>"       
        
        content += "<div><a href='http://kgs.uky.edu/kgsweb/datasearching/oilgas/ogresults.asp?recno="+feature.properties.record_number+"&areatype=recno' target='_blank'><u>Well Documents</u></a></div></div>"
        
        layer.on('mouseover mousemove', function(e){    
            var popup = new L.popup({ offset: new L.Point(0,-10), closeButton: true, autoPan: false })
                  .setContent(content)
                  .setLatLng(e.latlng)
                  .openOn(map);
              });
        
        layer.on('mouseout', function(e){ map.closePopup() });
        
  /*      layer.on('click', function(e){
       
        og.eachLayer(function(layer) {
            var distance = e.latlng.distanceTo(layer.getLatLng())/1000;
            
            console.log(layer)
            
            if (distance > 1) {
                    layer.setStyle({
                        stroke: false,
                        fill:false
                    });
            } else{
                layer.setStyle({
                    stroke: true,
                    fill: true 
                    });
                  }
            });
        });*/

    } 
     
  }).addTo(map);
    
    
  radiusCircle(); 

}    // end drawMap()
    
function getBreaks(wellData) {

     var values=[];
    wellData.features.forEach(function(feature) {
        var value = Number(feature.properties.total_depth);
        values.push(value);
    })
    var clusters = ss.ckmeans(values, 5);
        
    var breaks = clusters.map(function(cluster){
        return [cluster[0],cluster.pop()];
    });
    
    return breaks;
     
}
    
function ogMarker(d, breaks){
    
    
    if(d <= breaks[0][1]){
        return '#9e9ac8'
    }else if (d <= breaks [1][1]){
        return '#807dba'
    }else if (d <= breaks [2][1]){
        return '#6a51a3'
    }else if (d <= breaks[3][1]){
        return '#54278f'
    }else if (d <= breaks[4][1]){
        return '#3f007d'
    }
        
}

function waterMarker(d, breaks){

    
    if(d <= breaks[0][1]){
        return '#7fcdbb'
    }else if (d <= breaks [1][1]){
        return '#41b6c4'
    }else if (d <= breaks [2][1]){
        return '#1d91c0'
    }else if (d <= breaks[3][1]){
        return '#225ea8'
    }else if (d <= breaks[4][1]){
        return '#0c2c84'
    }
        
}       
    

    
function radiusCircle (){
    //create set radius around a well on click
    map.on('click', function(e){
       
       // og.eachLayer(function(layer) {
           
        var ogDistance = e.latlng.distanceTo(og.eachlayer.getLatLng())/1000;
            
            console.log(distance)
            
            if (distance > 1) {
                    layer.setStyle({
                        stroke: false,
                        fill:false
                    });
            } else{
                layer.setStyle({
                    stroke: true,
                    fill: true 
                });
            }
        
        var wwDistance = e.latlng.distanceTo(ww.eachlayer.getLatLng())/1000;
            
            console.log(distance)
            
            if (distance > 1) {
                    layer.setStyle({
                        stroke: false,
                        fill:false
                    });
            } else{
                layer.setStyle({
                    stroke: true,
                    fill: true 
                });
            }
       // });
    });
}    
</script>

</body>
</html>

